(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var o,e;function r(e){return 6!==(e=e.startsWith("#")?e.slice(1):e).length?(console.error("Invalid hex color format. It should be a 6-character string."),null):{red:parseInt(e.slice(0,2),16),green:parseInt(e.slice(2,4),16),blue:parseInt(e.slice(4,6),16)}}async function t(e,t){e=r(e)||r(o.defaultColor)||{red:128,green:128,blue:128},e=`https://${o.piledIP}/?R=${e.red}&G=${e.green}&B=${e.blue}&DURATION=`+t;try{console.log("Sending GET request to: ",e);var a=await fetch(e);a.ok?console.log("Sent color request: "+e):console.error("Error sending color request:",a.statusText)}catch(e){console.error("Network error:",e)}}async function a(){console.log("New Song: ",Spicetify.Player.data),Spicetify.Player.data.item.isLocal&&t(null==o?void 0:o.defaultColor,3);var e=await((e=await fetch(`https://api-partner.spotify.com/pathfinder/v1/query?operationName=fetchExtractedColors&variables=${encodeURIComponent(JSON.stringify({uris:[Spicetify.Player.data.item.metadata.image_url]}))}&extensions=`+encodeURIComponent(JSON.stringify({persistedQuery:{version:1,sha256Hash:"d7696dd106f3c84a1f3ca37225a1de292e66a2d5aced37a66632585eeb3bbbfa"}})),{method:"GET",headers:{authorization:"Bearer "+(await Spicetify.CosmosAsync.get("sp://oauth/v2/token")).accessToken}}).then(e=>e.json())).data.extractedColors?e.data.extractedColors[0].colorRaw.hex:o.defaultColor)||o.defaultColor;console.log("Song changed, new rgb: ",e),t(e,3)}o={piledIP:"led.polisan.dev",defaultColor:"#d000ff"},e=async function(){Spicetify.Player.addEventListener("songchange",a),Spicetify.Player.data?a():new MutationObserver((e,t)=>{Spicetify.Player.data&&(t.disconnect(),a())}).observe(document.body,{childList:!0,subtree:!0})},(async()=>{await e()})()})();